<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Introduce to Jasmine - SunsetSunrising</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"/>
    <link rel="stylesheet" href="/assets/style.css?v=a6013"/>
    <link rel="stylesheet" href="/assets/pygments.css?v=cedbb"/>
    
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="SunsetSunrising"/>
    
<link rel="canonical" href="/2010/about_jasmine.html" />


</head>
<body>
<!--http://vimeo.com/53043267-->
<div id="topbar"></div>
<header>
    <div id="logo"><a href="/">SunsetSunrising</a></div>
    <nav id="nav" role="navigation">
        
        <a  href="/">Home</a>
        <a  href="/about.html">About</a>
    </nav>
    <div id="search">
        <form action="" id="J_search" class="form-search">
            <input type="text" class="query" placeholder="Search"/>
            <button type="submit" class="btn">Go</button>
        </form>
    </div>
</header>
<div class="container"><h1 class="entry-title">Introduce to Jasmine</h1>
<div class="entry-meta">
    <time class="updated" datetime="2010-10-17T11:10:07+08:00">
        <a href="/2010/">2010-10-17</a>
    </time>
    <span class="author vcard">
        by <a class="url fn" href="http://sunsetsunrising.com">Yan Sheng</a>
        
    </span>
</div>
<div class="entry-content">
    <p>上次报告中讲到的 Jasmine, 但由于自己讲的太烂 &amp; 没讲清楚, 估计没人在意了. 所以在这再次介绍一下这个工具~</p>
<div class="section" id="jasmine">
<h2>Jasmine 介绍</h2>
<p>这单词本意是 &quot;茉莉花&quot; 的意思, 小而精致的一种花. 同样, JS 测试框架中的 Jasmine 也是一个小巧工具, 但功能不小巧~</p>
<p>他是一个用于 JS 测试的行为驱动开发(BDD)框架. 独立存在, 不依赖其他 JS 框架.</p>
<p>借一段文档上的代码:</p>
<blockquote>
<div class="highlight"><pre><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;Jasmine&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;makes testing JavaScript awesome!&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">yourCode</span><span class="p">).</span><span class="nx">toBeLotsBetter</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</blockquote>
<p>测试代码可以写成如上类似的样子, 代码看上去很自然语言了, 很易读~</p>
</div>
<div class="section" id="id1">
<h2>Jasmine 使用</h2>
<p>Specs: 说明, 使用 it(description, fn) 来描述;</p>
<blockquote>
<div class="highlight"><pre><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should increment a variable&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">foo</span><span class="o">++</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</blockquote>
<p>他用来说明 fn 中的动作要达到什么样的效果;</p>
<p>Expecations: 期望, 存在于 spec 中, 用来描述某值的期望结果, 使用 expect() + matchers;</p>
<blockquote>
<div class="highlight"><pre><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should increment a variable&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>            <span class="c1">// set up the world</span>
      <span class="nx">foo</span><span class="o">++</span><span class="p">;</span>                  <span class="c1">// call your application code</span>

      <span class="nx">expect</span><span class="p">(</span><span class="nx">foo</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// passes because foo == 1</span>
<span class="p">});</span>
</pre></div>
</blockquote>
<p>Suites: Specs 的集合, 相当于 Test　Case, 使用 describe 语句;</p>
<blockquote>
<div class="highlight"><pre><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Calculator&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;can add a number&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
      <span class="p">});</span>

      <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;has multiply some numbers&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
      <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</blockquote>
<ul class="simple">
<li>Suites 的名字一般为你要测试的模块/组件/应用名字;</li>
<li>Suites 中的每个 Spec 只执行一次, 一个 Suites, 一个作用域, 里面的 Spec 共享;</li>
<li>支持嵌套的 Describes;</li>
<li>beforeEach(fn)/afterEach(fn), 在每个 spec 执行之前/之后 执行;</li>
<li>this.after(fn) 在特定的某个 spec 执行之后执行, 但没有 this.before !</li>
<li>xit()/xdescribe() 设置 spec/describe 不可用.</li>
</ul>
<p>Matchers: 匹配者</p>
<blockquote>
<div class="highlight"><pre><span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// compares objects or primitives x and y and passes if they are equivalent</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>    <span class="c1">// compares objects or primitives x and y and passes if they are the same object</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="nx">pattern</span><span class="p">);</span> <span class="c1">// compares x to string or regular expression pattern and passes if they match</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>    <span class="c1">// passes if x is not undefined</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toBeNull</span><span class="p">();</span>       <span class="c1">// passes if x is null</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">();</span>     <span class="c1">// passes if x evaluates to true</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toBeFalsy</span><span class="p">();</span>      <span class="c1">// passes if x evaluates to false</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>     <span class="c1">// passes if array or string x contains y</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toBeLessThan</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>  <span class="c1">// passes if x is less than y</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>  <span class="c1">// passes if x is greater than y</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">fn</span><span class="p">).</span><span class="nx">toThrow</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>         <span class="c1">// passes if function fn throws exception e when executed</span>
</pre></div>
</blockquote>
<ul>
<li><p class="first">否定只需加 not</p>
<blockquote>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">&lt;string&gt;</tt>, line 102)</p>
<p>Content block expected for the &quot;sourcecode&quot; directive; none found.</p>
<pre class="literal-block">
.. sourcecode:: js
    expect(x).not.toEqual(y);      // compares objects or primitives x and y and passes if they are not equivalent


</pre>
</div>
</blockquote>
</li>
<li><p class="first">Matcher 是可以自定义的. 使用 <tt class="docutils literal">addMatchers(obj)</tt></p>
<blockquote>
<div class="highlight"><pre><span class="nx">toBeLessThan</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">actual</span> <span class="o">&lt;</span> <span class="nx">expected</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">addMatchers</span><span class="p">({</span>
    <span class="nx">toBeVisible</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">actual</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">();</span> <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</blockquote>
</li>
</ul>
<p>Spies/Asynchronous Specs</p>
<ul>
<li><p class="first">permit many spying, mocking, and faking behaviors. 用于模拟传参, 回调函数, 异步请求/行为监测</p>
</li>
<li><p class="first">支持异步测试, 测试 ajax api, 事件回调等, 就是针对在未来某个点上会发生的行为.</p>
</li>
<li><p class="first">runs() 阻塞执行, 就像是直接调用一样; 多个runs() 共享作用域.</p>
</li>
<li><p class="first">waits(timeout) 等待多长时间后再执行下面的语句.</p>
</li>
<li><p class="first">waitsFor(function, optional message, optional timeout) 直到 function 返回 true 才执行下去.</p>
<blockquote>
<div class="highlight"><pre><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Spreadsheet&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should calculate the total asynchronously&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">spreadsheet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Spreadsheet</span><span class="p">();</span>
    <span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">fillWith</span><span class="p">(</span><span class="nx">lotsOfFixureDataValues</span><span class="p">());</span>
    <span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">asynchronouslyCalculateTotal</span><span class="p">();</span>

    <span class="nx">waitsFor</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">calculationIsComplete</span><span class="p">();</span>
    <span class="p">},</span> <span class="s2">&quot;Spreadsheet calculation never completed&quot;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">);</span>

    <span class="nx">runs</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">total</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">123456</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</blockquote>
</li>
<li><p class="first">关于 spies, 偶自己使用时, 有时很奇怪他的行为,,可能是没更好的用. 有待进一步研究. 更多资料参见 <a class="reference external" href="http://pivotal.github.com/jasmine/spies.html">http://pivotal.github.com/jasmine/spies.html</a>.</p>
</li>
</ul>
<p>最后, 只要引入 jasmine 所需的css/js就可以让 Test Runner 跑起来</p>
<blockquote>
<div class="highlight"><pre><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;../../../tests/jasmine/jasmine.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../../../tests/jasmine/jasmine.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../../../tests/jasmine/jasmine-html.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../../../build/packages/kissy.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../test.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;script&gt;</span>
    <span class="nx">jasmine</span><span class="p">.</span><span class="nx">getEnv</span><span class="p">().</span><span class="nx">addReporter</span><span class="p">(</span><span class="k">new</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">TrivialReporter</span><span class="p">());</span>
    <span class="nx">jasmine</span><span class="p">.</span><span class="nx">getEnv</span><span class="p">().</span><span class="nx">execute</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>
</blockquote>
<p>打开页面就可以看到对应的结果了. 这样就不用人肉地执行重复的工作了!</p>
</div>
<div class="section" id="id2">
<h2>其他</h2>
<p>既然 jasmine 本身不依赖什么, 那么就可以和现有的其他 JS 测试工具结合使用, 比如和 js-test-driver 结合起来, 这样更加自动化.</p>
</div>
<div class="section" id="id3">
<h2>资料</h2>
<ul class="simple">
<li>Jasmine 文档: <a class="reference external" href="http://pivotal.github.com/jasmine/index.html">http://pivotal.github.com/jasmine/index.html</a></li>
<li>JQuery 的 jasmine 插件: <a class="reference external" href="http://blog.davidpadbury.com/2010/10/11/bdd-testing-of-jquery-plugins-using-jasmine/">http://blog.davidpadbury.com/2010/10/11/bdd-testing-of-jquery-plugins-using-jasmine/</a></li>
<li>BDD: <a class="reference external" href="http://en.wikipedia.org/wiki/Behavior_Driven_Development">http://en.wikipedia.org/wiki/Behavior_Driven_Development</a></li>
</ul>
</div>

</div>
<div class="entry-tags">
    <a href="/tag/#Javscript">Javscript</a>
</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'sunsetsunrising';
    var disqus_title = 'Introduce to Jasmine';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
</div>
<footer>
    <hr class="end"/>
    <p>&copy;2008~2012 Liz.</p>
</footer>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4419044-5']);
    _gaq.push(['_trackPageview']);
    _gaq.push(['_trackPageLoadTime']);
    (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
    })();
</script>
</body>
</html>